<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 JupyterHub in Alliance Canada | CC Primer: Compute Canada for geoscientists in a rush</title>
  <meta name="description" content="Descricao (campo)" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 JupyterHub in Alliance Canada | CC Primer: Compute Canada for geoscientists in a rush" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Descricao (campo)" />
  <meta name="github-repo" content="ricardobarroslourenco/CCprimer" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 JupyterHub in Alliance Canada | CC Primer: Compute Canada for geoscientists in a rush" />
  
  <meta name="twitter:description" content="Descricao (campo)" />
  

<meta name="author" content="Ricardo Barros Lourenco" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rstudio-in-alliance-canada.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-W4XJX7TX56"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-W4XJX7TX56');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">CC Primer</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Front Matter</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#copyright"><i class="fa fa-check"></i><b>1.1</b> Copyright</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#how-to-cite-this-work"><i class="fa fa-check"></i><b>1.1.1</b> How to cite this work</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#cronology"><i class="fa fa-check"></i><b>1.2</b> Cronology</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="version-control-systems.html"><a href="version-control-systems.html"><i class="fa fa-check"></i><b>2</b> Version Control Systems</a>
<ul>
<li class="chapter" data-level="2.1" data-path="version-control-systems.html"><a href="version-control-systems.html#vcs-local-repository-vs.-remote-repository"><i class="fa fa-check"></i><b>2.1</b> VCS: Local repository vs.Â Remote repository</a></li>
<li class="chapter" data-level="2.2" data-path="version-control-systems.html"><a href="version-control-systems.html#git"><i class="fa fa-check"></i><b>2.2</b> Git</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="version-control-systems.html"><a href="version-control-systems.html#installing-a-git-client-on-your-machine"><i class="fa fa-check"></i><b>2.2.1</b> Installing a git client on your machine</a></li>
<li class="chapter" data-level="2.2.2" data-path="version-control-systems.html"><a href="version-control-systems.html#setting-up-your-local-git-client"><i class="fa fa-check"></i><b>2.2.2</b> Setting up your local git client</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="version-control-systems.html"><a href="version-control-systems.html#github"><i class="fa fa-check"></i><b>2.3</b> GitHub</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="version-control-systems.html"><a href="version-control-systems.html#creating-an-account"><i class="fa fa-check"></i><b>2.3.1</b> Creating an account</a></li>
<li class="chapter" data-level="2.3.2" data-path="version-control-systems.html"><a href="version-control-systems.html#insert-github-credentials-on-your-local-git"><i class="fa fa-check"></i><b>2.3.2</b> Insert GitHub credentials on your local Git</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="version-control-systems.html"><a href="version-control-systems.html#a-combined-usage-of-git-github"><i class="fa fa-check"></i><b>2.4</b> A combined usage of Git-GitHub</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="version-control-systems.html"><a href="version-control-systems.html#basic-commands-to-update-a-repository"><i class="fa fa-check"></i><b>2.4.1</b> Basic commands to update a repository</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="compute-canada.html"><a href="compute-canada.html"><i class="fa fa-check"></i><b>3</b> Compute Canada</a>
<ul>
<li class="chapter" data-level="3.0.1" data-path="compute-canada.html"><a href="compute-canada.html#setting-up-ssh-on-compute-canada-portal"><i class="fa fa-check"></i><b>3.0.1</b> Setting up SSH on Compute Canada portal</a></li>
<li class="chapter" data-level="3.0.2" data-path="compute-canada.html"><a href="compute-canada.html#depositing-the-public-key-on-compute-canada"><i class="fa fa-check"></i><b>3.0.2</b> Depositing the public key on Compute Canada</a></li>
<li class="chapter" data-level="3.0.3" data-path="compute-canada.html"><a href="compute-canada.html#accessing-a-compute-canada-login-node"><i class="fa fa-check"></i><b>3.0.3</b> Accessing a Compute Canada <em>login node</em></a></li>
<li class="chapter" data-level="3.0.4" data-path="compute-canada.html"><a href="compute-canada.html#running-batch-jobs"><i class="fa fa-check"></i><b>3.0.4</b> Running batch jobs</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="bash.html"><a href="bash.html"><i class="fa fa-check"></i><b>4</b> BASH</a>
<ul>
<li class="chapter" data-level="4.1" data-path="bash.html"><a href="bash.html#screen"><i class="fa fa-check"></i><b>4.1</b> Screen</a></li>
<li class="chapter" data-level="4.2" data-path="bash.html"><a href="bash.html#how-to-use-it"><i class="fa fa-check"></i><b>4.2</b> How to use it</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="bash.html"><a href="bash.html#creating-a-session"><i class="fa fa-check"></i><b>4.2.1</b> Creating a session</a></li>
<li class="chapter" data-level="4.2.2" data-path="bash.html"><a href="bash.html#see-all-available-sessions"><i class="fa fa-check"></i><b>4.2.2</b> See all available sessions</a></li>
<li class="chapter" data-level="4.2.3" data-path="bash.html"><a href="bash.html#reattach-to-a-previously-established-session"><i class="fa fa-check"></i><b>4.2.3</b> Reattach to a previously established session</a></li>
<li class="chapter" data-level="4.2.4" data-path="bash.html"><a href="bash.html#finishing-a-session"><i class="fa fa-check"></i><b>4.2.4</b> Finishing a session</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rstudio-in-alliance-canada.html"><a href="rstudio-in-alliance-canada.html"><i class="fa fa-check"></i><b>5</b> RStudio in Alliance Canada</a>
<ul>
<li class="chapter" data-level="5.1" data-path="rstudio-in-alliance-canada.html"><a href="rstudio-in-alliance-canada.html#introduction"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="rstudio-in-alliance-canada.html"><a href="rstudio-in-alliance-canada.html#running-an-apptainer-hpc-container-as-an-interactive-session"><i class="fa fa-check"></i><b>5.2</b> Running an Apptainer HPC Container as an interactive session</a></li>
<li class="chapter" data-level="5.3" data-path="rstudio-in-alliance-canada.html"><a href="rstudio-in-alliance-canada.html#finishing-your-running-session."><i class="fa fa-check"></i><b>5.3</b> Finishing your Running session.</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="jupyterhub-in-alliance-canada.html"><a href="jupyterhub-in-alliance-canada.html"><i class="fa fa-check"></i><b>6</b> JupyterHub in Alliance Canada</a>
<ul>
<li class="chapter" data-level="6.1" data-path="jupyterhub-in-alliance-canada.html"><a href="jupyterhub-in-alliance-canada.html#introduction-1"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="jupyterhub-in-alliance-canada.html"><a href="jupyterhub-in-alliance-canada.html#running-an-apptainer-hpc-container-as-an-interactive-session-1"><i class="fa fa-check"></i><b>6.2</b> Running an Apptainer HPC Container as an interactive session</a></li>
<li class="chapter" data-level="6.3" data-path="jupyterhub-in-alliance-canada.html"><a href="jupyterhub-in-alliance-canada.html#finishing-your-running-session.-1"><i class="fa fa-check"></i><b>6.3</b> Finishing your Running session.</a></li>
</ul></li>
<li class="divider"></li>
<li>   <a href="//creativecommons.org/licenses/by-nc-sa/4.0"><img src="https://licensebuttons.net/l/by-nc-sa/3.0/88x31.png" alt="" width="88" height="31"></a></li>
<li><a href="https://zenodo.org/badge/latestdoi/454125724"><img src="https://zenodo.org/badge/454125724.svg" alt="DOI"></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">CC Primer: Compute Canada for geoscientists in a rush</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="jupyterhub-in-alliance-canada" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> JupyterHub in Alliance Canada<a href="jupyterhub-in-alliance-canada.html#jupyterhub-in-alliance-canada" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><em>Note 1</em>: This refers to an experimental usage of Python for HPC. This approach
has no official support from the Alliance, and the responsability is solely to
the user. An official Python environment is provided, with support, by the Alliance at
<a href="https://docs.alliancecan.ca/wiki/Python">this website</a>.</p>
<p><em>Note 2</em>: This approach is aimed to single node processes. We will address over time cases with multi-node trainings, but this is still under development (usage of the SOSA Stack - <a href="https://youtu.be/2SbpEiOM5JE">video</a>, <a href="https://zenodo.org/record/7857369">slides</a>). However, multi-node multi-gpu Deep Learning models can be already be trained with Horovod in Alliance machines (<a href="https://docs.alliancecan.ca/wiki/TensorFlow/en#Horovod">link</a>).</p>
<div id="introduction-1" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Introduction<a href="jupyterhub-in-alliance-canada.html#introduction-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this approach, we use an adaptation of a Docker container maintained by the <a href="https://pangeo.io">Pangeo Community</a> to install a custom setup of packages from the <a href="https://conda-forge.org">Conda-Forge</a> project. Containers are available at <a href="https://hub.docker.com/repository/docker/ricardobarroslourenco/ts_rs/general">Docker Hub</a>, with the releases and their code available on <a href="https://github.com/ricardobarroslourenco/rs_images">GitHub</a>.</p>
</div>
<div id="running-an-apptainer-hpc-container-as-an-interactive-session-1" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Running an Apptainer HPC Container as an interactive session<a href="jupyterhub-in-alliance-canada.html#running-an-apptainer-hpc-container-as-an-interactive-session-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Prior to be able to run JupyterLab, you need to have a suitable container already built
as a Singularity container, or build by yourself.</p>
<p><em>From the cluster login node</em> you can build it with the following steps (it is assumed that you are using <a href="https://en.wikipedia.org/wiki/Bash_(Unix_shell)">bash</a> as a regular user - no sudo needed):</p>
<p><strong>1. Load Apptainer</strong>:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="jupyterhub-in-alliance-canada.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load apptainer</span></code></pre></div>
<p>Pick up the most recent version of it, and accept.</p>
<p><strong>2. Then run the build</strong> (run this command at your <em>home</em>, <em>project</em> or <em>scratch</em> folder):</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb36-1"><a href="jupyterhub-in-alliance-canada.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="ex">apptainer</span> build ts_rs_v0_5.sif docker://ricardobarroslourenco/ts_rs:v0.5</span></code></pre></div>
<p>You should have, at the end, a file named <em>ts_rs_v0_5.sif</em> in the
directory you ran the command. This is your Apptainer container.</p>
<p><strong>3. Starting an Interactive Job on the Supercomputer</strong></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb37-1"><a href="jupyterhub-in-alliance-canada.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> salloc <span class="at">--time</span><span class="op">=</span>0:30:0 <span class="at">--account</span><span class="op">=</span>rrg-ggalex <span class="at">--cpus-per-task</span><span class="op">=</span>8 <span class="at">--mem</span><span class="op">=</span>0 <span class="at">--mail-user</span><span class="op">=</span>macid@mcmaster.ca <span class="at">--mail-type</span><span class="op">=</span>ALL</span></code></pre></div>
<p>The setup of the flags is defined as this (more details available at the Alliance Documentation, as well as on the Slurm manual):</p>
<ul>
<li><em>time</em>: time of the interactive session in HH:MM:SS;</li>
<li><em>account</em>: PI account at the Alliance Can project;</li>
<li><em>cpus-per-task</em>: Amount of cpus in this interactive session. Capped to the limit of the node;</li>
<li><em>mem</em>: amount of RAM you want to allocate (zero means all memory of the node);</li>
<li><em>mail-user</em>: e-mail address to send updates on the job allocation;</li>
<li><em>mail-type</em>: verbosity of the e-mail.</li>
</ul>
<p>After running this, you probably will see your bash change to something like (in the Graham cluster):</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb38-1"><a href="jupyterhub-in-alliance-canada.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> <span class="ex">[lourenco@gra-login1</span> scratch]$ salloc <span class="at">--time</span><span class="op">=</span>0:30:0 <span class="at">--account</span><span class="op">=</span>rrg-ggalex <span class="at">--cpus-per-task</span><span class="op">=</span>8 <span class="at">--mem</span><span class="op">=</span>0 <span class="at">--mail-user</span><span class="op">=</span>barroslr@mcmaster.ca <span class="at">--mail-type</span><span class="op">=</span>ALL</span>
<span id="cb38-2"><a href="jupyterhub-in-alliance-canada.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="ex">salloc:</span> Pending job allocation 6806097</span>
<span id="cb38-3"><a href="jupyterhub-in-alliance-canada.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="ex">salloc:</span> job 6806097 queued and waiting for resources</span>
<span id="cb38-4"><a href="jupyterhub-in-alliance-canada.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="ex">salloc:</span> job 6806097 has been allocated resources</span>
<span id="cb38-5"><a href="jupyterhub-in-alliance-canada.html#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="ex">salloc:</span> Granted job allocation 6806097</span>
<span id="cb38-6"><a href="jupyterhub-in-alliance-canada.html#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="ex">salloc:</span> Waiting for resource configuration</span>
<span id="cb38-7"><a href="jupyterhub-in-alliance-canada.html#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="ex">salloc:</span> Nodes gra189 are ready for job</span>
<span id="cb38-8"><a href="jupyterhub-in-alliance-canada.html#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> <span class="ex">[lourenco@gra189</span> scratch]$</span></code></pre></div>
<p>Please note that <strong>gra189</strong> in this case is your machine name. You need to remember it later to use it in your ssh tunnel.</p>
<p><strong>4. Start the container in the newly allocated working node</strong></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb39-1"><a href="jupyterhub-in-alliance-canada.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="ex">apptainer</span> shell <span class="at">--nv</span> <span class="at">-B</span> /home <span class="at">-B</span> /project <span class="at">-B</span> /scratch ts_rs_v0_5.sif</span></code></pre></div>
<p><strong>5. Launching JupyterLab</strong></p>
<p>The container is now started, and you need now to start JupyterLab. First, load the conda environment on the container:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb40-1"><a href="jupyterhub-in-alliance-canada.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> activate base</span></code></pre></div>
<p>Then start a JupyterLab session (this is a session that is headless):</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb41-1"><a href="jupyterhub-in-alliance-canada.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jupyter-lab</span> <span class="at">--no-browser</span> <span class="at">--ip</span> <span class="va">$(</span><span class="fu">hostname</span> <span class="at">-f</span><span class="va">)</span></span></code></pre></div>
<p>This will launch a JupyterLab server as a singularity service. If you need, bash is
available as a terminal tab in that JupyterLab. You should see something like this:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb42-1"><a href="jupyterhub-in-alliance-canada.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Apptainer</span><span class="op">&gt;</span> jupyter-lab <span class="at">--no-browser</span> <span class="at">--ip</span> <span class="va">$(</span><span class="fu">hostname</span> <span class="at">-f</span><span class="va">)</span></span>
<span id="cb42-2"><a href="jupyterhub-in-alliance-canada.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:36:57.713 ServerApp] Package jupyterlab took 0.0000s to import</span>
<span id="cb42-3"><a href="jupyterhub-in-alliance-canada.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:36:59.595 ServerApp] Package dask_labextension took 1.8814s to import</span>
<span id="cb42-4"><a href="jupyterhub-in-alliance-canada.html#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[W</span> 2023-06-07 11:36:59.595 ServerApp] A <span class="kw">`</span><span class="ex">_jupyter_server_extension_points</span><span class="kw">`</span> function was not found in dask_labextension. Instead, a <span class="kw">`</span><span class="ex">_jupyter_server_extension_paths</span><span class="kw">`</span> function was found and will be used for now. This function name will be deprecated in future releases of Jupyter Server.</span>
<span id="cb42-5"><a href="jupyterhub-in-alliance-canada.html#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:36:59.624 ServerApp] Package jupyter_lsp took 0.0291s to import</span>
<span id="cb42-6"><a href="jupyterhub-in-alliance-canada.html#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[W</span> 2023-06-07 11:36:59.624 ServerApp] A <span class="kw">`</span><span class="ex">_jupyter_server_extension_points</span><span class="kw">`</span> function was not found in jupyter_lsp. Instead, a <span class="kw">`</span><span class="ex">_jupyter_server_extension_paths</span><span class="kw">`</span> function was found and will be used for now. This function name will be deprecated in future releases of Jupyter Server.</span>
<span id="cb42-7"><a href="jupyterhub-in-alliance-canada.html#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:36:59.625 ServerApp] Package jupyter_server_proxy took 0.0000s to import</span>
<span id="cb42-8"><a href="jupyterhub-in-alliance-canada.html#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:36:59.644 ServerApp] Package jupyter_server_terminals took 0.0188s to import</span>
<span id="cb42-9"><a href="jupyterhub-in-alliance-canada.html#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:36:59.644 ServerApp] Package notebook_shim took 0.0000s to import</span>
<span id="cb42-10"><a href="jupyterhub-in-alliance-canada.html#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="ex">[W</span> 2023-06-07 11:36:59.644 ServerApp] A <span class="kw">`</span><span class="ex">_jupyter_server_extension_points</span><span class="kw">`</span> function was not found in notebook_shim. Instead, a <span class="kw">`</span><span class="ex">_jupyter_server_extension_paths</span><span class="kw">`</span> function was found and will be used for now. This function name will be deprecated in future releases of Jupyter Server.</span>
<span id="cb42-11"><a href="jupyterhub-in-alliance-canada.html#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:01.808 ServerApp] Package panel.io.jupyter_server_extension took 2.1617s to import</span>
<span id="cb42-12"><a href="jupyterhub-in-alliance-canada.html#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:01.808 ServerApp] dask_labextension <span class="kw">|</span> <span class="ex">extension</span> was successfully linked.</span>
<span id="cb42-13"><a href="jupyterhub-in-alliance-canada.html#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:01.808 ServerApp] jupyter_lsp <span class="kw">|</span> <span class="ex">extension</span> was successfully linked.</span>
<span id="cb42-14"><a href="jupyterhub-in-alliance-canada.html#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:01.808 ServerApp] jupyter_server_proxy <span class="kw">|</span> <span class="ex">extension</span> was successfully linked.</span>
<span id="cb42-15"><a href="jupyterhub-in-alliance-canada.html#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:01.813 ServerApp] jupyter_server_terminals <span class="kw">|</span> <span class="ex">extension</span> was successfully linked.</span>
<span id="cb42-16"><a href="jupyterhub-in-alliance-canada.html#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:01.818 ServerApp] jupyterlab <span class="kw">|</span> <span class="ex">extension</span> was successfully linked.</span>
<span id="cb42-17"><a href="jupyterhub-in-alliance-canada.html#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:02.927 ServerApp] notebook_shim <span class="kw">|</span> <span class="ex">extension</span> was successfully linked.</span>
<span id="cb42-18"><a href="jupyterhub-in-alliance-canada.html#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:02.927 ServerApp] panel.io.jupyter_server_extension <span class="kw">|</span> <span class="ex">extension</span> was successfully linked.</span>
<span id="cb42-19"><a href="jupyterhub-in-alliance-canada.html#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:02.972 ServerApp] notebook_shim <span class="kw">|</span> <span class="ex">extension</span> was successfully loaded.</span>
<span id="cb42-20"><a href="jupyterhub-in-alliance-canada.html#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:02.973 ServerApp] dask_labextension <span class="kw">|</span> <span class="ex">extension</span> was successfully loaded.</span>
<span id="cb42-21"><a href="jupyterhub-in-alliance-canada.html#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:02.975 ServerApp] jupyter_lsp <span class="kw">|</span> <span class="ex">extension</span> was successfully loaded.</span>
<span id="cb42-22"><a href="jupyterhub-in-alliance-canada.html#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:02.996 ServerApp] jupyter_server_proxy <span class="kw">|</span> <span class="ex">extension</span> was successfully loaded.</span>
<span id="cb42-23"><a href="jupyterhub-in-alliance-canada.html#cb42-23" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:02.997 ServerApp] jupyter_server_terminals <span class="kw">|</span> <span class="ex">extension</span> was successfully loaded.</span>
<span id="cb42-24"><a href="jupyterhub-in-alliance-canada.html#cb42-24" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:02.998 LabApp] JupyterLab extension loaded from /opt/conda/lib/python3.11/site-packages/jupyterlab</span>
<span id="cb42-25"><a href="jupyterhub-in-alliance-canada.html#cb42-25" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:02.998 LabApp] JupyterLab application directory is /opt/conda/share/jupyter/lab</span>
<span id="cb42-26"><a href="jupyterhub-in-alliance-canada.html#cb42-26" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:02.999 LabApp] Extension Manager is <span class="st">&#39;pypi&#39;</span>.</span>
<span id="cb42-27"><a href="jupyterhub-in-alliance-canada.html#cb42-27" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:03.001 ServerApp] jupyterlab <span class="kw">|</span> <span class="ex">extension</span> was successfully loaded.</span>
<span id="cb42-28"><a href="jupyterhub-in-alliance-canada.html#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:03.001 ServerApp] panel.io.jupyter_server_extension <span class="kw">|</span> <span class="ex">extension</span> was successfully loaded.</span>
<span id="cb42-29"><a href="jupyterhub-in-alliance-canada.html#cb42-29" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:03.002 ServerApp] Serving notebooks from local directory: /scratch/lourenco</span>
<span id="cb42-30"><a href="jupyterhub-in-alliance-canada.html#cb42-30" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:03.002 ServerApp] Jupyter Server 2.6.0 is running at:</span>
<span id="cb42-31"><a href="jupyterhub-in-alliance-canada.html#cb42-31" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:03.002 ServerApp] http://gra-login2.graham.sharcnet:8888/lab<span class="pp">?</span>token=4ccce5d0045ff5768194c8c7f37a7dc80220caaf68324b8b</span>
<span id="cb42-32"><a href="jupyterhub-in-alliance-canada.html#cb42-32" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:03.002 ServerApp]     http://127.0.0.1:8888/lab<span class="pp">?</span>token=4ccce5d0045ff5768194c8c7f37a7dc80220caaf68324b8b</span>
<span id="cb42-33"><a href="jupyterhub-in-alliance-canada.html#cb42-33" aria-hidden="true" tabindex="-1"></a><span class="ex">[I</span> 2023-06-07 11:37:03.002 ServerApp] Use Control-C to stop this server and shut down all kernels <span class="er">(</span><span class="ex">twice</span> to skip confirmation<span class="kw">)</span><span class="bu">.</span></span>
<span id="cb42-34"><a href="jupyterhub-in-alliance-canada.html#cb42-34" aria-hidden="true" tabindex="-1"></a><span class="ex">[C</span> 2023-06-07 11:37:03.028 ServerApp] </span>
<span id="cb42-35"><a href="jupyterhub-in-alliance-canada.html#cb42-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-36"><a href="jupyterhub-in-alliance-canada.html#cb42-36" aria-hidden="true" tabindex="-1"></a>    <span class="ex">To</span> access the server, open this file in a browser:</span>
<span id="cb42-37"><a href="jupyterhub-in-alliance-canada.html#cb42-37" aria-hidden="true" tabindex="-1"></a>        <span class="ex">file:///home/lourenco/.local/share/jupyter/runtime/jpserver-11176-open.html</span></span>
<span id="cb42-38"><a href="jupyterhub-in-alliance-canada.html#cb42-38" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Or</span> copy and paste one of these URLs:</span>
<span id="cb42-39"><a href="jupyterhub-in-alliance-canada.html#cb42-39" aria-hidden="true" tabindex="-1"></a>        <span class="ex">http://gra-login2.graham.sharcnet:8888/lab?token=4ccce5d0045ff5768194c8c7f37a7dc80220caaf68324b8b</span></span>
<span id="cb42-40"><a href="jupyterhub-in-alliance-canada.html#cb42-40" aria-hidden="true" tabindex="-1"></a>        <span class="ex">http://127.0.0.1:8888/lab?token=4ccce5d0045ff5768194c8c7f37a7dc80220caaf68324b8b</span></span></code></pre></div>
<p>Note that despite several urlâs are provided to access the JupyterLab server, the server does not know that is running withing a container, in a cluster, therefore such URLs do not immediately work, as you are accessing it through a tunnel. The only one able to access, <strong>after creating the ssh tunnel on port 8888</strong>, is <code>http://127.0.0.1:8888/lab?token=4ccce5d0045ff5768194c8c7f37a7dc80220caaf68324b8b</code>.</p>
<p>Reinforcing, to access the instance, you need
to do a ssh tunnel, to forward the cluster port in the working node, to your machine. For that, <strong>you must to create a new, separate, ssh connection, and keep it open</strong> (without
running any job on it). You can do as this (similar to what we described in the ssh section of CCPrimer, with a twist):</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb43-1"><a href="jupyterhub-in-alliance-canada.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> <span class="at">-i</span> ~/computecanada/computecanada-key <span class="at">-L</span> 8888:graXXX:8888 username@graham.computecanada.ca</span></code></pre></div>
<p>Some details:</p>
<ul>
<li><em>-i ~/computecanada/computecanada-key</em>: the <em>-i</em> flag calls your ssh key file;</li>
<li><em>-L 8888:graXXX:8888</em>: the <em>ssh tunnel</em> in fact. It forwards node port 8888 to your localhost at port 8888. Note that <strong>you must replace graXXX with the node name of the machine assigned to you</strong> after running <em>salloc</em>. If you use Dask in your jobs, it is available within the 8888, not needing to open aditional ports for the dashboards;</li>
<li><em><a href="mailto:username@graham.computecanada.ca" class="email">username@graham.computecanada.ca</a></em>: your username, followed by the cluster url. Note that our lab research allocation is available in Graham for now.</li>
</ul>
<p>After this, you should be able to access the rstudio server by using this url
in your browser:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb44-1"><a href="jupyterhub-in-alliance-canada.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="ex">http://127.0.0.1:8888/lab?token=XXXXXXXXXXXXXXXXXXXXXXX</span></span></code></pre></div>
<p>Remember that this is an example, so you need to get the token URL provided by JupyterLab once launching the session.</p>
</div>
<div id="finishing-your-running-session.-1" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Finishing your Running session.<a href="jupyterhub-in-alliance-canada.html#finishing-your-running-session.-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Do not forget saving your work in partitions that enable saving (ex.: <code>/home</code>, <code>/project</code>, <code>/scratch</code>), because <strong>if you save in a folder within the container, it will not be saved</strong>, after your session ends. Remember that <code>/scratch</code> is meant for temporary save, being automatically wiped by the cluster systems after 30 days.</p>
<p>Once saved, you can simply end your running sessions by either using <code>Ctrl + C</code> in the apptainer run session, and then calling <code>exit</code> on bash up to ending the <code>salloc</code> session, and another time, to relinquish the ssh session (remember to do this both in the bash session that runs the jobs, as well in the ssh tunnel). At the end you will only see the bash of your local machine. It is important to do this procedure, because otherwise it may be possible that the machine is still running, and consument the group Alliance Canada credits. Once you finish the slurm <code>salloc</code> session you will receive an e-mail (as you got one when the session started), telling that the session has finished (or relinquished, if your runnign time expired).</p>

<!-- # End matter -->
<!-- ## Appendix A - Useful References -->
<!-- List references such as websites, and other written material supporting geocomputation efforts -->
<!-- ```{r include=FALSE} -->
<!-- # automatically create a bib database for R packages -->
<!-- knitr::write_bib(c( -->
<!--   .packages(), 'bookdown', 'knitr', 'rmarkdown' -->
<!-- ), 'packages.bib') -->
<!-- ``` -->

<div id="refs" class="references csl-bib-body">
<div class="csl-entry">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">Wikipedia contributors, <span>âVersion control â <span>W</span>ikipedia<span>,</span> the free encyclopedia.â</span> 2002.Available: <a href="https://en.wikipedia.org/wiki/Version_control">https://en.wikipedia.org/wiki/Version_control</a></div>
</div>
<div class="csl-entry">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline">Compute Canada, <span>â<span>SSH Key</span> â <span>CC Doc</span>.â</span> 2002.Available: <a href="https://docs.computecanada.ca/wiki/SSH_Keys">https://docs.computecanada.ca/wiki/SSH_Keys</a></div>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="rstudio-in-alliance-canada.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ricardobarroslourenco/CCprimer/edit/master/05-Jupyter.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
